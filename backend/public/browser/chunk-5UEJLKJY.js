import{e as m}from"./chunk-KOLTPGQS.js";import{a as g}from"./chunk-PKDV3UHM.js";import{a as p}from"./chunk-54OJTUEO.js";import{O as u,S as l,X as i,g as c}from"./chunk-ZWUYIRHV.js";var s=class extends Error{};s.prototype.name="InvalidTokenError";function h(r){return decodeURIComponent(atob(r).replace(/(.)/g,(e,t)=>{let o=t.charCodeAt(0).toString(16).toUpperCase();return o.length<2&&(o="0"+o),"%"+o}))}function b(r){let e=r.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return h(e)}catch{return atob(e)}}function d(r,e){if(typeof r!="string")throw new s("Invalid token specified: must be a string");e||(e={});let t=e.header===!0?0:1,o=r.split(".")[t];if(typeof o!="string")throw new s(`Invalid token specified: missing part #${t+1}`);let a;try{a=b(o)}catch(n){throw new s(`Invalid token specified: invalid base64 for part #${t+1} (${n.message})`)}try{return JSON.parse(a)}catch(n){throw new s(`Invalid token specified: invalid json for part #${t+1} (${n.message})`)}}var f=class r{constructor(e,t){this.http=e;this.router=t;let o=localStorage.getItem("auth_token"),a=localStorage.getItem("user_data");if(a!=null)try{this.userSubject.next(JSON.parse(a))}catch(n){console.error("Error parsing user data from localStorage:",n),localStorage.removeItem("user_data")}}API_URL=g.API_URL;userSubject=new c(null);user$=this.userSubject.asObservable();login(e,t){return this.http.post(`${this.API_URL}/auth/sign-in`,{email:e,password:t}).pipe(u(o=>{localStorage.setItem("auth_token",o.accessToken);let a=d(o.accessToken),n={id:a.sub,email:a.email,firstName:a.firstName,lastName:a.lastName,role:a.role};localStorage.setItem("user_data",JSON.stringify(n)),this.userSubject.next(n)}))}logout(){localStorage.removeItem("auth_token"),localStorage.removeItem("user_data"),this.userSubject.next(null),this.router.navigate(["/login"])}isUser(){return this.userSubject.value?.role==="user"}isAdmin(){return this.userSubject.value?.role==="admin"}getToken(){return localStorage.getItem("auth_token")}getCurrentUser(){return this.userSubject.value}getBaseURL(){return this.API_URL}static \u0275fac=function(t){return new(t||r)(i(p),i(m))};static \u0275prov=l({token:r,factory:r.\u0275fac,providedIn:"root"})};export{f as a};
