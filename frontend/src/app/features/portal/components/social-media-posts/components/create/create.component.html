<div class="create-post-container">
  <h1>Create Social Media Post</h1>

  <div class="loading-overlay" *ngIf="isLoading">
    <div class="loader"></div>
  </div>

  <form #postForm="ngForm" (ngSubmit)="onSubmit(postForm)" class="post-form">
    <!-- Brand Selection Section -->
    <div class="form-section" [class.active]="formSections.brand">
      <div class="section-header" (click)="toggleSection('brand')">
        <div class="section-title">01 // Brand Selection</div>
        <div class="toggle-icon">↓</div>
      </div>

      <div class="section-content">
        <div class="form-group">
          <label for="brandId">Brand:</label>
          <select
            [(ngModel)]="post.brandId"
            name="brandId"
            required
            class="form-control tech-select"
            (change)="onBrandSelect()"
          >
            <option [ngValue]="0">Select a Brand</option>
            <option *ngFor="let brand of brands" [value]="brand.id">
              {{ brand.name }}
            </option>
          </select>
        </div>
      </div>
    </div>

    <!-- Content Details Section -->
    <div class="form-section" [class.active]="formSections.content">
      <div class="section-header" (click)="toggleSection('content')">
        <div class="section-title">02 // Content Configuration</div>
        <div class="toggle-icon">↓</div>
      </div>

      <div class="section-content">
        <div class="form-group">
          <label for="platform">Platform:</label>
          <select
            [(ngModel)]="post.platform"
            name="platform"
            required
            class="form-control"
          >
            <option *ngFor="let p of platforms" [value]="p">{{ p }}</option>
          </select>
        </div>

        <div class="form-group">
          <label for="language">Language:</label>
          <select
            [(ngModel)]="post.language"
            name="language"
            required
            class="form-control"
          >
            <option *ngFor="let lang of languages" [value]="lang">
              {{ lang }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label for="contentTone">Content Tone:</label>
          <select
            [(ngModel)]="post.contentTone"
            name="contentTone"
            required
            class="form-control"
          >
            <option *ngFor="let tone of contentTones" [value]="tone">
              {{ tone }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label for="link">Link:</label>
          <input
            [(ngModel)]="post.link"
            name="link"
            type="url"
            required
            class="form-control"
            placeholder="Enter content link"
          />
        </div>
      </div>
    </div>

    <!-- Creative Elements Section -->
    <div class="form-section" [class.active]="formSections.creative">
      <div class="section-header" (click)="toggleSection('creative')">
        <div class="section-title">03 // Creative Elements</div>
        <div class="toggle-icon">↓</div>
      </div>

      <div class="section-content">
        <div class="form-row">
          <div class="form-group">
            <label for="format">Format:</label>
            <select
              [(ngModel)]="post.dimensions"
              name="format"
              required
              class="form-control"
            >
              <option *ngFor="let f of dimensions" [value]="f">{{ f }}</option>
            </select>
          </div>

          <div class="form-group">
            <label for="creativeType">Creative Type:</label>
            <select
              [(ngModel)]="post.creativeType"
              name="creativeType"
              required
              class="form-control"
            >
              <option *ngFor="let type of creativeTypes" [value]="type">
                {{ type }}
              </option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="thumbnail">Thumbnail:</label>
            <select
              [(ngModel)]="post.thumbnail"
              name="thumbnail"
              required
              class="form-control"
            >
              <option *ngFor="let t of thumbnails" [value]="t">
                {{ t }}
              </option>
            </select>
          </div>

          <!-- Sound multi-select -->
          <div
            class="form-group custom-multi-select-container"
            #dropdownContainer
          >
            <label>Sound:</label>
            <div class="custom-select-trigger" (click)="toggleDropdown()">
              <div class="selected-values">
                <span *ngIf="post.sound.length === 0">Select sounds...</span>
                <span *ngFor="let s of post.sound; let i = index">
                  {{ s }}<span *ngIf="i < post.sound.length - 1">, </span>
                </span>
              </div>
              <div class="arrow" [class.open]="dropdownOpen">&#9662;</div>
            </div>

            <div class="custom-dropdown-panel" *ngIf="dropdownOpen">
              <div class="checkbox-option" *ngFor="let s of sounds">
                <input
                  type="checkbox"
                  [checked]="post.sound.includes(s)"
                  (change)="onCheckboxChange($event, s)"
                  [id]="'sound_' + s"
                />
                <label [for]="'sound_' + s">{{ s }}</label>
              </div>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="duration">Duration:</label>
          <select
            [(ngModel)]="post.duration"
            name="duration"
            required
            class="form-control"
          >
            <option *ngFor="let d of durations" [value]="d">{{ d }}</option>
          </select>
        </div>

        <!-- Concept multi-select -->
        <div class="form-group custom-multi-select-container" #conceptDropdownContainer>
          <label>Concept:</label>
          <div class="custom-select-trigger" (click)="toggleConceptDropdown()">
            <div class="selected-values">
              <span *ngIf="post.concept.length === 0">Select concepts...</span>
              <span *ngFor="let c of post.concept; let i = index">
                {{ c }}<span *ngIf="i < post.concept.length - 1">, </span>
              </span>
            </div>
            <div class="arrow" [class.open]="conceptDropdownOpen">&#9662;</div>
          </div>

          <div class="custom-dropdown-panel" *ngIf="conceptDropdownOpen">
            <div class="checkbox-option" *ngFor="let c of concepts">
              <input
                type="checkbox"
                [checked]="post.concept.includes(c)"
                (change)="onConceptCheckboxChange($event, c)"
                [id]="'concept_' + c"
              />
              <label [for]="'concept_' + c">{{ c }}</label>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Metrics Section -->
    <div class="form-section" [class.active]="formSections.metrics">
      <div class="section-header" (click)="toggleSection('metrics')">
        <div class="section-title">04 // Metrics</div>
        <div class="toggle-icon">↓</div>
      </div>

      <div class="section-content">
        <div class="form-group">
          <label for="views">Views:</label>
          <input
            [(ngModel)]="post.views"
            name="views"
            type="number"
            required
            class="form-control"
            placeholder="Enter number of views"
          />
        </div>

        <div class="form-group">
          <label for="comments">Comments:</label>
          <input
            [(ngModel)]="post.comments"
            name="comments"
            type="number"
            required
            class="form-control"
            placeholder="Enter number of comments"
          />
        </div>

        <div class="form-group">
          <label for="likes">Likes:</label>
          <input
            [(ngModel)]="post.likes"
            name="likes"
            type="number"
            required
            class="form-control"
            placeholder="Enter number of likes"
          />
        </div>

        <div class="form-group">
          <label for="shares">Shares:</label>
          <input
            [(ngModel)]="post.shares"
            name="shares"
            type="number"
            required
            class="form-control"
            placeholder="Enter number of shares"
          />
        </div>

        <div class="form-group">
          <label for="saves">Saves:</label>
          <input
            [(ngModel)]="post.saves"
            name="saves"
            type="number"
            required
            class="form-control"
            placeholder="Enter number of saves"
          />
        </div>
      </div>
    </div>

    <!-- Target Audience Section -->
    <div class="form-section" [class.active]="formSections.targetAudience">
      <div class="section-header" (click)="toggleSection('targetAudience')">
        <div class="section-title">05 // Target Audience</div>
        <div class="toggle-icon">↓</div>
      </div>

      <div class="section-content">
        <div class="form-row">
          <div class="form-group">
            <label for="targetAudienceAge">Audience Age:</label>
            <select
              [(ngModel)]="post.targetAudienceAge"
              name="targetAudienceAge"
              required
              class="form-control"
            >
              <option *ngFor="let age of targetAudienceAges" [value]="age">
                {{ age }}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label for="targetAudienceGender">Audience Gender:</label>
            <select
              [(ngModel)]="post.targetAudienceGender"
              name="targetAudienceGender"
              required
              class="form-control"
            >
              <option
                *ngFor="let gender of targetAudienceGenders"
                [value]="gender"
              >
                {{ gender }}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label for="targetAudienceIncome">Audience Income:</label>
            <select
              [(ngModel)]="post.targetAudienceIncome"
              name="targetAudienceIncome"
              required
              class="form-control"
            >
              <option
                *ngFor="let income of targetAudienceIncomes"
                [value]="income"
              >
                {{ income }}
              </option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- Campaign Details Section -->
    <div class="form-section" [class.active]="formSections.campaign">
      <div class="section-header" (click)="toggleSection('campaign')">
        <div class="section-title">06 // Campaign Details</div>
        <div class="toggle-icon">↓</div>
      </div>

      <div class="section-content">
        <div class="form-row">
          <div class="form-group">
            <label for="campaignObjective">Campaign Objective:</label>
            <select
              [(ngModel)]="post.campaignObjective"
              name="campaignObjective"
              required
              class="form-control"
            >
              <option *ngFor="let obj of campaignObjectives" [value]="obj">
                {{ obj }}
              </option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="callToAction">Call To Action:</label>
          <select
            [(ngModel)]="post.callToAction"
            name="callToAction"
            required
            class="form-control"
          >
            <option *ngFor="let cta of callToActions" [value]="cta">
              {{ cta }}
            </option>
          </select>
        </div>

        <!-- PromoCode checkbox -->
        <div class="form-group checkbox-group">
          <input
            type="checkbox"
            id="agree"
            [(ngModel)]="post.promoCode"
            name="promoCode"
          />
          <label for="agree">Promo Code</label>
        </div>

        <div class="form-group checkbox-group">
          <input
            type="checkbox"
            id="hook"
            [(ngModel)]="post.hook"
            name="hook"
          />
          <label for="hook">Hook</label>
        </div>

        <div class="form-group">
          <label for="publishedAt">Published At:</label>
          <input
            [(ngModel)]="post.publishedAt"
            name="publishedAt"
            type="date"
            required
            class="form-control"
            (focus)="onFocus($event)"
          />
        </div>
      </div>
    </div>

    <div class="form-actions">
      <button
        type="submit"
        [disabled]="!postForm.valid || !isFormValid() || isLoading"
        class="submit-btn"
      >
        <span class="btn-text">Initialize Post Creation</span>
        <span class="btn-overlay"></span>
      </button>
    </div>
  </form>

  <div class="message" *ngIf="message">
    {{ message }}
  </div>
</div>
